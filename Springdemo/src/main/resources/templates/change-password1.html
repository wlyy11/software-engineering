<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>修改密码</title>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('changePasswordForm');
            form.addEventListener('submit', function(event) {
                event.preventDefault(); // 阻止表单默认提交行为

                // 获取表单数据
                const formData = {
                    username: document.getElementById('username').value,
                    oldPassword: document.getElementById('oldPassword').value,
                    newPassword: document.getElementById('newPassword').value
                };

                // 将表单数据转换为 JSON 字符串
                const jsonFormData = JSON.stringify(formData);

                // 创建请求
                const request = new XMLHttpRequest();
                request.open('PUT', '/user/change-password', true);
                request.setRequestHeader('Content-Type', 'application/json');

                // 处理响应
                request.onload = function() {
                    if (request.status >= 200 && request.status < 400) {
                        // 请求成功，处理响应
                        alert('密码修改成功！');
                    } else {
                        // 请求失败
                        alert('密码修改失败：' + request.responseText);
                    }
                };

                // 发送请求
                request.send(jsonFormData);
            });
        });
    </script>
</head>
<body>
    <h2>修改密码</h2>

    <!-- 表单提交到 PUT 接口 -->
    <form id="changePasswordForm">
        <div>
            <label>用户名:</label>
            <input type="text" id="username" name="username" th:value="${username}" readonly required> <!-- 使用th:value替代value -->
        </div>
        <div>
            <label for="oldPassword">旧密码:</label>
            <input type="password" id="oldPassword" name="oldPassword" required />
        </div>
        <div>
            <label for="newPassword">新密码:</label>
            <input type="password" id="newPassword" name="newPassword" required />
        </div>
        <div>
            <button type="submit">提交修改</button>
        </div>
    </form>
</body>
</html>

